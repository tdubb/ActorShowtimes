<body onunload="GUnload()">
<% require "nokogiri" %>
<% require "open-uri" %>


    <table border=1>
      <tr>
        <td>
           <div id="map" style="width: 550px; height: 450px"></div>
        </td>
        <td width = 150 valign="top" style="text-decoration: underline; color: #4444ff;">
           <div id="side_bar"></div>
        </td>
      </tr>
    </table>


	<div class="row">
	<div class="small-1 columns" > &nbsp</div>
		<div class="small-5 columns">
		<% if user_signed_in? %>
<%= link_to "Back", index_path%>
<% else %>
<%= link_to "Back", root_path%>
<% end %>
	<% if @flicks.empty? %>
	<p>Sorry to report but we are not aware of any current playing movies starring:</p>
	<h3><%= @actor.name %></h3>
	<img src=<%=@actor.picture_url%>>
	<% else %>
	<ol>
		 
		 	<% @flicks.each do |name, theater| %>
			<br>
		<li>
			<%= theater.name %>
		</li>
			
			<%= theater.address %>
			
				<% theater.films.each do |title, film| %>
				<br>
					<span class="title"><%= film.title %></span>
				<br>
						<%= film.times.gsub(/(nbsp)/, " ") %>
					<br>
				<% end %>
			<% end %>
		
	 </ol>
	 <% end %>
	</div>
	 <div class="small-6 columns">
	 	<div style="text-align:center">
	 		
	<% address_array = [] %>
	<% @flicks.each do |name, theater| %>
			<% address_array << theater.address %>
			<%= Geocoder.coordinates(theater.address) %><br>
	<% end %>

	<p>
		
	<br>
		<% if @actor.picture_url.nil? %>
			<h3><%= @actor.name %></h3>
			<%= image_tag 'no_profile.jpg' %>
		<% end %>
		</div>
		<% if !@flicks.empty? %>
		<div class="centered">
		<h3><%= @actor.name %></h3>
		<br>
		<img src=<%= @actor.picture_url %>>
		</div>

	 	<img style="size: 600x300" border="0" src="//maps.googleapis.com/maps/api/staticmap?center=<%=@zipcode%>&amp;size=600x600&amp;sensor=false&amp;zoom=10&amp;markers=color:green%7Clabel:1%7C2901$<%= address_array[0] %>&amp;markers=color:green%7Clabel:2%7C2901$<%= address_array[1] %>&amp;markers=color:green%7Clabel:3%7C2901$<%= address_array[2] %>" alt="Austin, TX">
	
	<% end %>

	</div>
</div>

  <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=false&amp;key=ABQIAAAAPDUET0Qt7p2VcSk6JNU1sBSM5jMcmVqUpI7aqV44cW1cEECiThQYkcZUPRJn9vy_TWxWvuLoOfSFBw" type="text/javascript"></script>
<script type="text/javascript">
    //<![CDATA[


    if (GBrowserIsCompatible()) {
      var Icon = new GIcon(G_DEFAULT_ICON);
      Icon.image = "coldmarker.png";
    
      var side_bar_html = "";

      var gmarkers = [];
      var htmls = [];
      var i = 0;

      // A function to create the marker and set up the event window
      function createMarker(point,name,html) {
        var marker = new GMarker(point,Icon);
        GEvent.addListener(marker, "click", function() {
          marker.openInfoWindowHtml(html);
        });

        // Switch icon on marker mouseover and mouseout
        GEvent.addListener(marker, "mouseover", function() {
          marker.setImage("marker.png");
        });
        GEvent.addListener(marker, "mouseout", function() {
          marker.setImage("coldmarker.png");
        });
        gmarkers[i] = marker;
        htmls[i] = html;
        // add a line to the side_bar html, with click, mouseover and mouseout event handlers
        side_bar_html += '<a href="javascript:myclick(' + i + ')" onmouseover="gmarkers['+i+'].setImage(\'marker.png\')" onmouseout="gmarkers['+i+'].setImage(\'coldmarker.png\')">' + name + '<\/a><br>';
        i++;
        return marker;
      }

      // This function picks up the click and opens the corresponding info window
      function myclick(i) {
        gmarkers[i].openInfoWindowHtml(htmls[i]);
      }
      
    cineMap = gon.flicks;
		//console.log("gon values: "+cineMap);
		location2 ="";
		for(var key in cineMap){
   		//console.log("attrName: "+key+" "+cineMap[key]['address']);
   		//location2 = cineMap[key]['address'];
   		location2 = cineMap[key]['latlng'];
   		break;
 		}

      // create the map
      var map = new GMap2(document.getElementById("map"));
      map.addControl(new GLargeMapControl());
      map.addControl(new GMapTypeControl());
			map.setCenter(new GLatLng(43.907787,-79.359741),9);	
			map.setCenter(new GLatLng(location2[0],location2[1]),9);	

      // Read the data from example.xml
      // var request = GXmlHttp.create();
      // request.open("GET", "example.xml", true);
      // request.onreadystatechange = function() {
      //   if (request.readyState == 4) {
      //     var xmlDoc = GXml.parse(request.responseText);
      //     // obtain the array of markers and loop through it
      //     var markers = xmlDoc.documentElement.getElementsByTagName("marker");
          
          // for (var i = 0; i < markers.length; i++) {
          //   // obtain the attribues of each marker
          //   var lat = parseFloat(markers[i].getAttribute("lat"));
          //   var lng = parseFloat(markers[i].getAttribute("lng"));
          //   var point = new GLatLng(lat,lng);
          //   var html = markers[i].getAttribute("html");
          //   var label = markers[i].getAttribute("label");
          //   // create the marker
          //   var marker = createMarker(point,label,html);
          //   map.addOverlay(marker);
          // }
          for(var key in cineMap){
   					//console.log("attrName: "+key+" "+cineMap[key]['address']);
   					//location2 = cineMap[key]['address'];
   					location2 = cineMap[key]['latlng'];
   					var lat = location2[0];
   					var lng = location2[1];
   					var point = new GLatLng(lat,lng);
   					var html = key;
   					var label = key;
   					var marker = createMarker(point,label,html);
            map.addOverlay(marker);
 					}
          // put the assembled side_bar_html contents into the side_bar div
          document.getElementById("side_bar").innerHTML = side_bar_html;
    //     }
    //   }
    //   request.send(null);
     }

    else {
      alert("Sorry, the Google Maps API is not compatible with this browser");
    }

    // This Javascript is based on code provided by the
    // Community Church Javascript Team
    // http://www.bisphamchurch.org.uk/   
    // http://econym.org.uk/gmap/

    //]]>
    </script>
</body>